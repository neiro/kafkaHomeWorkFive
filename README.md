# –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Kafka-–∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Yandex Cloud

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è Kafka-–∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Yandex Cloud —Å –ø–æ–º–æ—â—å—é Terraform, –∞ —Ç–∞–∫–∂–µ –µ–≥–æ –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å—Ä–µ–¥–µ.

## üöÄ 1. –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Ç–µ—Ä–µ

–ö–ª–∞—Å—Ç–µ—Ä Kafka —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç –≤ Yandex Managed Service for Apache Kafka¬Æ —Å —Ç–∞–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
|-----------------------|------------------------------|
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–∫–µ—Ä–æ–≤   | 3                            |
| –í–µ—Ä—Å–∏—è Kafka          | 3.5                          |
| Schema Registry       | ‚úÖ –≤–∫–ª—é—á—ë–Ω                   |
| Public IP             | ‚úÖ –≤–∫–ª—é—á—ë–Ω                   |
| –ó–æ–Ω—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏      | ru-central1-a, ru-central1-b, ru-central1-d |
| –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è    | ‚ùå –æ—Ç–∫–ª—é—á–µ–Ω–∞                 |
| –¢–∏–ø –æ–∫—Ä—É–∂–µ–Ω–∏—è         | PRODUCTION                   |

## üñ•Ô∏è 2. –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—Ä–æ–∫–µ—Ä–æ–≤ –∏ Zookeeper

### üü¢ Kafka-–±—Ä–æ–∫–µ—Ä—ã:

- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:** 3
- **CPU:** 2 —è–¥—Ä–∞ (s2.micro)
- **RAM:** 8 –ì–ë (s2.micro)
- **–¢–∏–ø –∏ —Ä–∞–∑–º–µ—Ä –¥–∏—Å–∫–∞:** Network SSD, 30 GB

### üîµ Zookeeper:

- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤:** 3 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –±—Ä–æ–∫–µ—Ä–∞–º–∏)
- **CPU:** 2 —è–¥—Ä–∞ (s2.micro)
- **RAM:** 8 –ì–ë
- **–¢–∏–ø –∏ —Ä–∞–∑–º–µ—Ä –¥–∏—Å–∫–∞:** Network SSD, 30 GB

## üîß 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Kafka-–∫–ª–∞—Å—Ç–µ—Ä–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä                      | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
|-------------------------------|------------------------------|
| –ü–æ–ª–∏—Ç–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏              | compact                      |
| –í—Ä–µ–º—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤          | 7 –¥–Ω–µ–π (168 —á–∞—Å–æ–≤)           |
| –†–∞–∑–º–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ –ª–æ–≥–æ–≤         | 1 GB                         |
| –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è | 10 MB                        |
| –†–µ–ø–ª–∏–∫–∞—Ü–∏—è                    | 3                            |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π           | 3                            |
| –¢–∏–ø –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏                | LZ4                          |
| –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±—Ä–æ—Å–∞ –ª–æ–≥–æ–≤ –Ω–∞ –¥–∏—Å–∫  | 1000 –º—Å / 10000 —Å–æ–æ–±—â–µ–Ω–∏–π    |
| –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ —Å–±—Ä–æ—Å–∞ –ª–æ–≥–æ–≤ | 1000 –º—Å                  |
| –•—Ä–∞–Ω–µ–Ω–∏–µ offset'–æ–≤            | 7 –¥–Ω–µ–π                       |
| SSL Cipher Suite              | TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 |
| SASL-–º–µ—Ö–∞–Ω–∏–∑–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏  | SCRAM-SHA-512                |

## üìå 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üåê VPC –∏ –ø–æ–¥—Å–µ—Ç–∏:

| –ü–æ–¥—Å–µ—Ç—å      | –ó–æ–Ω–∞          | CIDR-–±–ª–æ–∫     |
|--------------|---------------|---------------|
| mysubnet-a   | ru-central1-a | 10.5.0.0/24   |
| mysubnet-b   | ru-central1-b | 10.5.1.0/24   |
| mysubnet-d   | ru-central1-d | 10.5.2.0/24   |

### üîë –ì—Ä—É–ø–ø–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (kafka-std-sg):

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ               | –ü–æ—Ä—Ç | –ü—Ä–æ—Ç–æ–∫–æ–ª | Source CIDR     |
|--------------------------|------|----------|-----------------|
| Kafka Inter-Broker SSL    | 9091 | TCP      | 0.0.0.0/0       |
| Kafka Clients             | 9092 | TCP      | 0.0.0.0/0       |
| Kafka Internal Traffic    | 9092 | TCP      | 10.5.0.0/16     |
| Kafka External (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | 9093 | TCP | 0.0.0.0/0       |
| Schema Registry API       | 443  | TCP      | 0.0.0.0/0       |
| Zookeeper Client          | 2181 | TCP      | 10.5.0.0/16     |
| Zookeeper Peer            | 2888 | TCP      | 10.5.0.0/16     |
| Zookeeper Election        | 3888 | TCP      | 10.5.0.0/16     |

## üóÉÔ∏è 5. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤

–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ–ø–∏–∫–∞ `my_topic`:

| –ü–∞—Ä–∞–º–µ—Ç—Ä              | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
|-----------------------|------------------------------|
| –ù–∞–∑–≤–∞–Ω–∏–µ              | my_topic                     |
| –ü–∞—Ä—Ç–∏—Ü–∏–∏              | 3                            |
| –§–∞–∫—Ç–æ—Ä —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏     | 3                            |
| –û—á–∏—Å—Ç–∫–∞               | compact                      |
| Retention             | 7 –¥–Ω–µ–π (604800000 ms)        |
| –°–∂–∞—Ç–∏–µ                | lz4                          |
| –†–∞–∑–º–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞       | 1 GB                         |
| Max —Å–æ–æ–±—â–µ–Ω–∏–µ         | 10 MB                        |

## üë§ 6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Kafka

–°–æ–∑–¥–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—è–º–∏ –∏ –¥–æ—Å—Ç—É–ø–æ–º:

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –†–æ–ª—å      | –î–æ—Å—Ç—É–ø –∫ —Ç–æ–ø–∏–∫—É | Source CIDR     |
|--------------|-----------|-----------------|-----------------|
| producer     | PRODUCER  | my_topic        | 0.0.0.0/0       |
| consumer     | CONSUMER  | my_topic        | 0.0.0.0/0       |

## üì¶ 7. Terraform-–∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ Terraform:

```bash
terraform init
terraform plan
terraform apply
